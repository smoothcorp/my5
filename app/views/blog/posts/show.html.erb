<% content_for :body_content_left do %>
    <%= raw @page[Page.default_parts.first.to_sym] if Page.default_parts.any? %>
    <%= render 'blog/shared/blog_title' %>

    <% if @blog_posts.any? %>
        <div id="show_blog_post">
          <% flash.each do |key, value| %>
              <div id='flash' class="flash flash_<%= key %>">
                <%= value %>
              </div>
          <% end %>
          <article id="blog_post">
            <header>
              <h1><%= @blog_post.title %></h1>
              <section class='details'>
                <time datetime="<%= l @blog_post.published_at.to_date, :format => :default %>" class='posted_at'>
                  <%= t('created_at', :scope => 'blog.shared.posts', :when => l(@blog_post.published_at.to_date, :format => :short)) %>
                </time>
                <%= "#{t('by', :scope => 'blog.posts.show')} #{@blog_post.author.username}" if @blog_post.author.present? %>
                .
                <% if (categories = @blog_post.categories).any? %>
                    <aside class='filed_in'>
                      <%= t('filed_in', :scope => 'blog.posts.show') %>
                      <% categories.each_with_index do |category, index| %>
                          <%= link_to category.title, blog_category_url(category) -%><%= ',' if index < ((categories.length) - 1) %>
                      <% end %>
                    </aside>
                <% end %>
              </section>
            </header>
            <%= @blog_post.body.html_safe %>

            <% if BlogPost::ShareThis.enabled? %>
                <span class="st_sharethis" displayText="ShareThis"></span>
            <% end %>
          </article>
          <%= render :partial => '/shared/draft_page_message' unless @blog_post.nil? or @blog_post.live? -%>
        </div>

        <% if BlogPost.comments_allowed? %>
            <div class="comment_button">
              <div class="comment_icon"></div>
              <% comments_count = @blog_post.comments.count %>
              <div class="comment_counter"><%= pluralize(comments_count, "Comment") if comments_count > 0 %></div>
            </div>

            <div class="print_button">
              <div class="print_icon"></div>
              <div class="print_link">Print</div>
            </div>

            <aside id="comments" style="display: none">
              <h2><%= t('.comments.title') %></h2>
              <% if (comments = @blog_post.comments.approved).any? %>
                  <%= render :partial => "comment", :collection => comments %>
              <% else %>
                  <p>
                    <%= t('none', :scope => 'blog.shared.comments') %>.
                  </p>
              <% end %>

              <% flash.each do |key, value| %>
                  <div id='flash' class="flash flash_<%= key %>">
                    <%= value %>
                  </div>
              <% end %>

              <h2><%= t('.comments.add') %></h2>
              <%= form_for [:blog_post, @blog_comment] do |f| %>
                  <%= render :partial => "/shared/admin/error_messages",
                             :locals  => {
                                     :object              => f.object,
                                     :include_object_name => true
                             } %>
                  <div class='field'>
                    <%= f.label :name %>
                    <%= f.text_field :name %>
                  </div>
                  <div class='field'>
                    <%= f.label :email %>
                    <%= f.email_field :email %>
                  </div>
                  <div class='field message_field'>
                    <%= f.label :message %>
                    <%= f.text_area :message, :rows => 6 %>
                  </div>
                  <div class='field form-actions'>
                    <%= f.submit t('.submit') %>
                  </div>
              <% end %>
            </aside>
        <% end %>

    <% else %>
        <p><%= t('.no_blog_articles_yet') %></p>
    <% end %>
<% end %>

<% content_for :body_content_right, :style => 'margin-top: -99px; border-left: 1px solid #b0b1b3;' do %>
    <div class="sidebar_section_wrap logo">
      <img src="/images/blog/my_five.jpg" alt=""/>
    </div>
    <%= form_tag my5_naturally_search_path, :class => 'search_form' do %>
        <%= search_field_tag('search', nil, :placeholder => 'Enter search term...', :class => 'search_input') %>
        <%= submit_tag 'Ok', :class => 'button search_button' %>
    <% end %>
    <%= raw @page[Page.default_parts.second.to_sym] if Page.default_parts.many? %>
    <div class="sidebar_section_wrap">
      <%= render :partial => "/blog/shared/categories" %>
    </div>
    <% if current_customer.customer_visits.any? %>
        <div class="sidebar_section_wrap">
          <h2 class="red"> Recent Articles </h2>
          <%= list_recent_articles %>
        </div>
    <% end %>
    <div class="sidebar_section_wrap">
      <%= render :partial => "/blog/shared/archive_list" %>
    </div>
<% end %>

<%= render :partial => "/shared/content_page", :locals => { :remove_automatic_sections => true } %>
<% content_for :stylesheets, stylesheet_link_tag('refinerycms-blog') %>
<% content_for :before_javascript_libraries, jquery_include_tags(:jquery_ui => false) %>
<% content_for :javascripts do %>
    <%# enable AJAX'd post nav at your own risk until html5 history API implemented. %>
    <%#= javascript_include_tag('refinerycms-blog') %>
    <script src="http://w.sharethis.com/button/buttons.js"></script>
    <script>stLight.options({publisher: '<%= BlogPost::ShareThis.key %>'});</script>
<% end if BlogPost::ShareThis.enabled? %>
